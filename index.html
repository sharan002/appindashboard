<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WhatsApp Dashboard - Enhanced Premium</title>
<script src="https://cdn.jsdelivr.net/npm/react@18.0.0/umd/react.development.js"></script>
<script src="https://cdn.jsdelivr.net/npm/react-dom@18.0.0/umd/react-dom.development.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.js"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --primary-color: #008069;
  --primary-dark: #005e4c;
  --primary-light: #25d366;
  --secondary-color: #111b21;
  --background-light: #f0f2f5;
  --background-dark: #0b141a;
  --message-sent: #d9fdd3;
  --message-received: #ffffff;
  --text-primary: #111b21;
  --text-secondary: #667781;
  --text-light: #8696a0;
  --border-color: #e9edef;
  --shadow-sm: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
  --shadow-md: 0 4px 6px rgba(0,0,0,0.1), 0 2px 4px rgba(0,0,0,0.06);
  --shadow-lg: 0 10px 25px rgba(0,0,0,0.1), 0 6px 10px rgba(0,0,0,0.08);
  --shadow-xl: 0 20px 40px rgba(0,0,0,0.15);
  --gradient-primary: linear-gradient(135deg, #008069 0%, #005e4c 100%);
  --gradient-secondary: linear-gradient(135deg, #25d366 0%, #128c7e 100%);
  --transition-fast: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-normal: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

[data-theme="dark"] {
  --background-light: #0b141a;
  --background-dark: #0b141a;
  --message-sent: #005c4b;
  --message-received: #1f2c33;
  --text-primary: #e9edef;
  --text-secondary: #8696a0;
  --border-color: #2a3942;
  --secondary-color: #111b21;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  background: var(--background-light);
  color: var(--text-primary);
  overflow-x: hidden;
  line-height: 1.6;
  height: 100vh;
}

html, body, #root {
  height: 100%;
}

.container {
  display: flex;
  height: 100vh;
  background: var(--background-light);
  position: relative;
  overflow: hidden;
}

/* Sidebar Styles */
.sidebar {
  width: 320px;
  background: var(--background-dark);
  display: flex;
  flex-direction: column;
  box-shadow: var(--shadow-lg);
  position: relative;
  z-index: 10;
  transition: var(--transition-normal);
  height: 100%;
}

.sidebar-header {
  padding: 20px;
  background: var(--gradient-primary);
  color: white;
  display: flex;
  align-items: center;
  justify-content: space-between;
  position: relative;
  overflow: hidden;
  flex-shrink: 0;
}

.sidebar-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 100%);
  pointer-events: none;
}

.sidebar-header-content {
  display: flex;
  align-items: center;
  z-index: 1;
  flex: 1;
}

.sidebar-header i {
  margin-right: 12px;
  font-size: 28px;
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.sidebar-header h2 {
  font-weight: 600;
  font-size: 20px;
  letter-spacing: -0.5px;
}

.theme-toggle {
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  font-size: 18px;
  cursor: pointer;
  padding: 8px;
  border-radius: 50%;
  transition: var(--transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  margin-left: 8px;
  z-index: 1;
}

.theme-toggle:hover {
  background: rgba(255,255,255,0.3);
  transform: scale(1.1);
}

.search-bar {
  padding: 20px;
  background: var(--secondary-color);
  border-bottom: 1px solid rgba(255,255,255,0.05);
  flex-shrink: 0;
}

.search-container {
  position: relative;
}

.search-input {
  width: 100%;
  padding: 12px 16px 12px 45px;
  border: none;
  border-radius: 12px;
  background: rgba(255,255,255,0.1);
  color: white;
  outline: none;
  font-size: 14px;
  transition: var(--transition-fast);
  backdrop-filter: blur(10px);
}

.search-input::placeholder {
  color: rgba(255,255,255,0.6);
}

.search-input:focus {
  background: rgba(255,255,255,0.15);
  box-shadow: 0 0 0 2px rgba(37, 211, 102, 0.3);
}

.search-icon {
  position: absolute;
  left: 15px;
  top: 50%;
  transform: translateY(-50%);
  color: rgba(255,255,255,0.6);
  font-size: 16px;
}

.users-list {
  flex: 1;
  overflow-y: auto;
  background: var(--background-dark);
}

.users-list::-webkit-scrollbar {
  width: 6px;
}

.users-list::-webkit-scrollbar-track {
  background: transparent;
}

.users-list::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.1);
  border-radius: 3px;
}

.users-list::-webkit-scrollbar-thumb:hover {
  background: rgba(255,255,255,0.2);
}

.user-item {
  display: flex;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid rgba(255,255,255,0.05);
  cursor: pointer;
  transition: var(--transition-fast);
  position: relative;
  overflow: hidden;
}

.user-item::before {
  content: '';
  position: absolute;
  left: 0;
  top: 0;
  bottom: 0;
  width: 3px;
  background: var(--primary-light);
  transform: translateX(-100%);
  transition: var(--transition-fast);
}

.user-item:hover {
  background: rgba(255,255,255,0.05);
}

.user-item:hover::before {
  transform: translateX(0);
}

.user-item.active {
  background: rgba(37, 211, 102, 0.1);
}

.user-item.active::before {
  transform: translateX(0);
}

.user-avatar-container {
  position: relative;
  margin-right: 14px;
  flex-shrink: 0;
}

.user-avatar {
  width: 48px;
  height: 48px;
  border-radius: 50%;
  object-fit: cover;
  border: 2px solid rgba(255,255,255,0.1);
  transition: var(--transition-fast);
}

.user-item:hover .user-avatar {
  border-color: var(--primary-light);
  transform: scale(1.05);
}

.unread-badge {
  position: absolute;
  top: -4px;
  right: -4px;
  background: var(--primary-light);
  color: white;
  border-radius: 50%;
  width: 20px;
  height: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 10px;
  font-weight: 600;
  animation: bounceIn 0.3s ease-out;
}

@keyframes bounceIn {
  0% { transform: scale(0); }
  50% { transform: scale(1.2); }
  100% { transform: scale(1); }
}

.user-info {
  flex: 1;
  min-width: 0;
  overflow: hidden;
}

.user-info-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 4px;
}

.user-info h4 {
  font-weight: 600;
  color: white;
  font-size: 15px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.user-info .last-message-time {
  font-size: 12px;
  color: var(--text-light);
  flex-shrink: 0;
  margin-left: 8px;
}

.user-info p {
  font-size: 13px;
  color: var(--text-light);
  display: flex;
  align-items: center;
  gap: 4px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.online-indicator {
  width: 8px;
  height: 8px;
  background: #25d366;
  border-radius: 50%;
  display: inline-block;
  animation: blink 2s infinite;
  flex-shrink: 0;
}

@keyframes blink {
  0%, 100% { opacity: 1; }
  50% { opacity: 0.5; }
}

.no-results {
  padding: 20px;
  text-align: center;
  color: var(--text-light);
  font-size: 14px;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  height: 100%;
}

/* Main Chat Area */
.main {
  flex: 1;
  display: flex;
  flex-direction: column;
  background: var(--background-light);
  position: relative;
  height: 100%;
  overflow: hidden;
}

.chat-header {
  padding: 16px 24px;
  background: white;
  border-bottom: 1px solid var(--border-color);
  display: flex;
  align-items: center;
  justify-content: space-between;
  box-shadow: var(--shadow-sm);
  position: relative;
  z-index: 5;
  flex-shrink: 0;
}

[data-theme="dark"] .chat-header {
  background: var(--secondary-color);
}

.chat-header-left {
  display: flex;
  align-items: center;
  flex: 1;
  min-width: 0;
}

.chat-header-info {
  display: flex;
  flex-direction: column;
  justify-content: center;
  min-width: 0;
  overflow: hidden;
}

.chat-header-info h3 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
  color: var(--text-primary);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.chat-header-info p {
  margin: 0;
  font-size: 13px;
  color: var(--text-secondary);
  display: flex;
  align-items: center;
  gap: 6px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.chat-header-actions {
  display: flex;
  align-items: center;
  gap: 16px;
  flex-shrink: 0;
}

.header-action-btn {
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 20px;
  cursor: pointer;
  padding: 8px;
  border-radius: 50%;
  transition: var(--transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 40px;
  height: 40px;
  flex-shrink: 0;
}

.header-action-btn:hover {
  background: var(--background-light);
  color: var(--primary-color);
  transform: scale(1.1);
}

.delete-icon {
  color: var(--text-secondary);
  cursor: pointer;
  font-size: 20px;
  transition: var(--transition-fast);
  flex-shrink: 0;
}

.delete-icon:hover {
  color: #dc3545;
  transform: scale(1.1);
}

.chat-messages {
  flex: 1;
  padding: 24px;
  overflow-y: auto;
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23f0f2f5"/><circle cx="20" cy="20" r="2" fill="%23e9edef" opacity="0.5"/><circle cx="80" cy="80" r="2" fill="%23e9edef" opacity="0.5"/><circle cx="50" cy="50" r="1" fill="%23e9edef" opacity="0.3"/></svg>');
  background-size: 100px 100px;
  position: relative;
  display: flex;
  flex-direction: column;
}

[data-theme="dark"] .chat-messages {
  background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%230b141a"/><circle cx="20" cy="20" r="2" fill="%231f2c33" opacity="0.5"/><circle cx="80" cy="80" r="2" fill="%231f2c33" opacity="0.5"/><circle cx="50" cy="50" r="1" fill="%231f2c33" opacity="0.3"/></svg>');
}

.chat-messages::-webkit-scrollbar {
  width: 6px;
}

.chat-messages::-webkit-scrollbar-track {
  background: transparent;
}

.chat-messages::-webkit-scrollbar-thumb {
  background: rgba(0,0,0,0.1);
  border-radius: 3px;
}

[data-theme="dark"] .chat-messages::-webkit-scrollbar-thumb {
  background: rgba(255,255,255,0.1);
}

.chat-messages::-webkit-scrollbar-thumb:hover {
  background: rgba(0,0,0,0.2);
}

[data-theme="dark"] .chat-messages::-webkit-scrollbar-thumb:hover {
  background: rgba(255,255,255,0.2);
}

.scroll-to-bottom {
  position: absolute;
  bottom: 100px;
  right: 24px;
  background: white;
  border: none;
  border-radius: 50%;
  width: 48px;
  height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  box-shadow: var(--shadow-lg);
  transition: var(--transition-fast);
  z-index: 10;
  color: var(--text-secondary);
}

.scroll-to-bottom:hover {
  transform: scale(1.1);
  box-shadow: var(--shadow-xl);
  color: var(--primary-color);
}

[data-theme="dark"] .scroll-to-bottom {
  background: var(--secondary-color);
}

.message {
  display: flex;
  margin-bottom: 16px;
  animation: slideInUp 0.3s ease-out;
  position: relative;
  max-width: 100%;
  align-items: flex-end;
}

@keyframes slideInUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.message.user {
  justify-content: flex-start;
}

.message.bot {
  justify-content: flex-end;
}

.message-content {
  max-width: 70%;
  padding: 12px 16px;
  border-radius: 18px;
  line-height: 1.5;
  position: relative;
  box-shadow: var(--shadow-sm);
  transition: var(--transition-fast);
  word-wrap: break-word;
}

.message-content:hover {
  transform: translateY(-2px);
  box-shadow: var(--shadow-md);
}

.message.user .message-content {
  background: var(--message-sent);
  color: var(--text-primary);
  border-bottom-left-radius: 4px;
}

.message.bot .message-content {
  background: var(--message-received);
  color: var(--text-primary);
  border-bottom-right-radius: 4px;
  border: 1px solid var(--border-color);
}

.message-content strong {
  font-weight: 600;
  color: var(--primary-color);
  display: block;
  margin-bottom: 4px;
  font-size: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.message-footer {
  display: flex;
  align-items: center;
  gap: 4px;
  margin-top: 6px;
  font-size: 11px;
  color: var(--text-light);
  justify-content: flex-end;
}

.message.user .message-footer {
  justify-content: flex-start;
}

.message-time {
  font-size: 11px;
  color: var(--text-light);
}

.message-status {
  font-size: 12px;
  color: var(--primary-light);
  display: flex;
  align-items: center;
}

.status-sent {
  color: var(--text-light);
}

.status-delivered {
  color: var(--text-light);
}

.status-read {
  color: var(--primary-light);
}

.input-area {
  padding: 20px 24px;
  background: white;
  border-top: 1px solid var(--border-color);
  display: flex;
  gap: 12px;
  align-items: flex-end;
  box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
  flex-shrink: 0;
}

[data-theme="dark"] .input-area {
  background: var(--secondary-color);
}

.input-container {
  flex: 1;
  position: relative;
  display: flex;
  flex-direction: column;
  background: var(--background-light);
  border-radius: 24px;
  padding: 0 16px;
  transition: var(--transition-fast);
  min-width: 0;
}

.input-container:focus-within {
  box-shadow: 0 0 0 2px var(--primary-light);
}

.file-preview {
  display: flex;
  gap: 8px;
  padding: 8px 0;
  flex-wrap: wrap;
}

.file-preview-item {
  position: relative;
  padding: 8px 12px;
  background: rgba(0,0,0,0.05);
  border-radius: 8px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 12px;
}

[data-theme="dark"] .file-preview-item {
  background: rgba(255,255,255,0.05);
}

.file-preview-item img {
  width: 40px;
  height: 40px;
  object-fit: cover;
  border-radius: 4px;
}

.file-preview-remove {
  background: none;
  border: none;
  color: var(--text-secondary);
  cursor: pointer;
  padding: 2px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.file-preview-remove:hover {
  color: #dc3545;
}

.input-row {
  display: flex;
  align-items: center;
}

.input-field {
  flex: 1;
  padding: 12px 0;
  border: none;
  background: transparent;
  outline: none;
  font-size: 15px;
  color: var(--text-primary);
  min-width: 0;
  max-height: 120px;
  overflow-y: auto;
  resize: none;
  font-family: inherit;
}

.input-field::placeholder {
  color: var(--text-secondary);
}

.input-actions {
  display: flex;
  gap: 8px;
  flex-shrink: 0;
}

.input-action-btn {
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 20px;
  cursor: pointer;
  padding: 8px;
  border-radius: 50%;
  transition: var(--transition-fast);
  display: flex;
  align-items: center;
  justify-content: center;
  width: 36px;
  height: 36px;
  flex-shrink: 0;
  position: relative;
}

.input-action-btn:hover {
  background: rgba(0,0,0,0.05);
  color: var(--primary-color);
  transform: scale(1.1);
}

.file-input {
  display: none;
}

.send-button {
  padding: 12px 24px;
  background: var(--gradient-secondary);
  color: white;
  border: none;
  border-radius: 30px;
  cursor: pointer;
  font-weight: 600;
  font-size: 15px;
  transition: var(--transition-fast);
  display: flex;
  align-items: center;
  gap: 8px;
  box-shadow: var(--shadow-md);
  flex-shrink: 0;
}

.send-button:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: var(--shadow-lg);
}

.send-button:active {
  transform: translateY(0);
}

.send-button:disabled {
  opacity: 0.5;
  cursor: not-allowed;
}

.no-user-selected {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100%;
  color: var(--text-secondary);
  background: white;
  flex: 1;
}

[data-theme="dark"] .no-user-selected {
  background: var(--background-dark);
}

.no-user-content {
  text-align: center;
  padding: 40px;
  max-width: 400px;
}

.no-user-content i {
  font-size: 80px;
  color: var(--primary-color);
  margin-bottom: 24px;
  opacity: 0.8;
  animation: float 3s ease-in-out infinite;
}

@keyframes float {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-10px); }
}

.no-user-content h3 {
  font-size: 24px;
  margin-bottom: 12px;
  color: var(--text-primary);
  font-weight: 600;
}

.no-user-content p {
  font-size: 16px;
  margin-bottom: 24px;
  color: var(--text-secondary);
}

/* Emoji Picker */
.emoji-picker {
  position: absolute;
  bottom: 100%;
  left: 0;
  background: white;
  border-radius: 12px;
  box-shadow: var(--shadow-xl);
  padding: 16px;
  margin-bottom: 8px;
  width: 320px;
  max-height: 300px;
  overflow-y: auto;
  z-index: 100;
}

[data-theme="dark"] .emoji-picker {
  background: var(--secondary-color);
  border: 1px solid var(--border-color);
}

.emoji-picker-grid {
  display: grid;
  grid-template-columns: repeat(8, 1fr);
  gap: 4px;
}

.emoji-item {
  padding: 8px;
  border: none;
  background: none;
  font-size: 24px;
  cursor: pointer;
  border-radius: 6px;
  transition: var(--transition-fast);
}

.emoji-item:hover {
  background: var(--background-light);
  transform: scale(1.2);
}

/* Notification Permission Banner */
.notification-banner {
  background: var(--gradient-secondary);
  color: white;
  padding: 12px 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  animation: slideDown 0.3s ease-out;
}

@keyframes slideDown {
  from {
    transform: translateY(-100%);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

.notification-banner-content {
  display: flex;
  align-items: center;
  gap: 12px;
  flex: 1;
}

.notification-banner-content i {
  font-size: 24px;
}

.notification-banner-text {
  flex: 1;
}

.notification-banner-text h4 {
  margin: 0 0 4px 0;
  font-size: 14px;
  font-weight: 600;
}

.notification-banner-text p {
  margin: 0;
  font-size: 12px;
  opacity: 0.9;
}

.notification-banner-actions {
  display: flex;
  gap: 8px;
}

.notification-banner button {
  padding: 8px 16px;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  font-size: 13px;
  transition: var(--transition-fast);
}

.notification-banner .btn-enable {
  background: white;
  color: var(--primary-color);
}

.notification-banner .btn-enable:hover {
  transform: scale(1.05);
}

.notification-banner .btn-dismiss {
  background: rgba(255,255,255,0.2);
  color: white;
}

.notification-banner .btn-dismiss:hover {
  background: rgba(255,255,255,0.3);
}

/* Mobile Menu Toggle Button */
.mobile-menu-toggle {
  display: none;
  position: absolute;
  top: 15px;
  right: 15px;
  background: rgba(255,255,255,0.2);
  border: none;
  color: white;
  font-size: 24px;
  cursor: pointer;
  z-index: 20;
  width: 40px;
  height: 40px;
  border-radius: 50%;
  transition: var(--transition-fast);
  backdrop-filter: blur(10px);
  align-items: center;
  justify-content: center;
}

.mobile-menu-toggle:hover {
  background: rgba(255,255,255,0.3);
  transform: scale(1.1);
}

/* Back Button for Mobile */
.mobile-back-button {
  display: none;
  background: none;
  border: none;
  color: var(--text-secondary);
  font-size: 20px;
  margin-right: 12px;
  cursor: pointer;
  padding: 8px;
  border-radius: 50%;
  transition: var(--transition-fast);
  align-items: center;
  justify-content: center;
  flex-shrink: 0;
}

.mobile-back-button:hover {
  background: var(--background-light);
  color: var(--primary-color);
}

/* Mobile Menu Items */
.mobile-menu-items {
  display: none;
  flex-direction: column;
  padding: 16px;
  border-top: 1px solid rgba(255,255,255,0.1);
  background: var(--secondary-color);
  flex-shrink: 0;
}

.mobile-menu-item {
  display: flex;
  align-items: center;
  padding: 12px 16px;
  color: white;
  text-decoration: none;
  border-radius: 8px;
  transition: var(--transition-fast);
  margin-bottom: 8px;
  cursor: pointer;
}

.mobile-menu-item:hover {
  background: rgba(255,255,255,0.1);
}

.mobile-menu-item i {
  margin-right: 12px;
  font-size: 18px;
  flex-shrink: 0;
}

.mobile-menu-item span {
  font-size: 15px;
}

/* Overlay for mobile when sidebar is open */
.sidebar-overlay {
  display: none;
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0,0,0,0.5);
  z-index: 99;
  backdrop-filter: blur(5px);
  opacity: 0;
  transition: opacity 0.3s ease;
}

.sidebar-overlay.active {
  display: block;
  opacity: 1;
}

/* Loading animation */
.loading-spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 3px solid rgba(255,255,255,0.3);
  border-radius: 50%;
  border-top-color: white;
  animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
  to { transform: rotate(360deg); }
}

/* Typing indicator */
.typing-indicator {
  display: flex;
  align-items: center;
  gap: 4px;
  padding: 8px 12px;
  background: var(--message-received);
  border-radius: 18px;
  border-bottom-right-radius: 4px;
  border: 1px solid var(--border-color);
  box-shadow: var(--shadow-sm);
}

.typing-dot {
  width: 8px;
  height: 8px;
  background: var(--text-secondary);
  border-radius: 50%;
  animation: typing 1.4s infinite;
}

.typing-dot:nth-child(2) {
  animation-delay: 0.2s;
}

.typing-dot:nth-child(3) {
  animation-delay: 0.4s;
}

@keyframes typing {
  0%, 60%, 100% {
    transform: translateY(0);
  }
  30% {
    transform: translateY(-10px);
  }
}

/* Responsive Styles */
@media (max-width: 768px) {
  .container {
    position: relative;
  }
  
  .sidebar {
    position: fixed;
    top: 0;
    left: 0;
    height: 100vh;
    width: 320px;
    transform: translateX(-100%);
    transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    z-index: 100;
  }
  
  .sidebar.open {
    transform: translateX(0);
  }
  
  .mobile-menu-toggle {
    display: flex;
  }
  
  .mobile-menu-items {
    display: flex;
  }
  
  .main {
    width: 100%;
  }
  
  .mobile-back-button {
    display: flex;
  }
  
  .chat-header {
    padding: 12px 16px;
  }
  
  .chat-header-info h3 {
    font-size: 16px;
  }
  
  .chat-header-info p {
    font-size: 12px;
  }
  
  .chat-header-actions .header-action-btn {
    display: none;
  }
  
  .chat-header-actions .delete-icon {
    display: none;
  }
  
  .message-content {
    max-width: 80%;
    padding: 10px 14px;
    font-size: 14px;
  }
  
  .message-time {
    font-size: 10px;
  }
  
  .input-area {
    padding: 16px;
  }
  
  .input-field {
    font-size: 16px; /* Prevents zoom on iOS */
  }
  
  .send-button {
    padding: 12px 20px;
    font-size: 14px;
  }
  
  .user-item {
    padding: 14px 16px;
  }
  
  .user-avatar {
    width: 44px;
    height: 44px;
  }
  
  .user-info h4 {
    font-size: 14px;
  }
  
  .user-info p {
    font-size: 12px;
  }
  
  .emoji-picker {
    width: 280px;
  }
}

@media (max-width: 480px) {
  .sidebar {
    width: 85%;
    max-width: 320px;
  }
  
  .sidebar-header {
    padding: 16px;
  }
  
  .sidebar-header h2 {
    font-size: 18px;
  }
  
  .search-bar {
    padding: 16px;
  }
  
  .search-input {
    padding: 10px 14px 10px 40px;
    font-size: 14px;
  }
  
  .chat-header {
    padding: 10px 16px;
    flex-wrap: wrap;
  }
  
  .chat-header-info h3 {
    font-size: 16px;
  }
  
  .chat-header-info p {
    font-size: 12px;
  }
  
  .chat-messages {
    padding: 16px;
  }
  
  .message {
    margin-bottom: 12px;
  }
  
  .message-content {
    max-width: 85%;
    padding: 8px 12px;
    font-size: 14px;
  }
  
  .input-area {
    padding: 12px 16px;
  }
  
  .input-field {
    padding: 10px 0;
    font-size: 16px;
  }
  
  .send-button {
    padding: 10px 16px;
    font-size: 14px;
  }
  
  .user-item {
    padding: 12px 16px;
  }
  
  .user-avatar {
    width: 40px;
    height: 40px;
  }
  
  .user-info h4 {
    font-size: 14px;
  }
  
  .user-info p {
    font-size: 11px;
  }
  
  .no-user-content i {
    font-size: 60px;
  }
  
  .no-user-content h3 {
    font-size: 20px;
  }
  
  .no-user-content p {
    font-size: 14px;
  }
}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">
const { useState, useEffect, useRef, useMemo } = React;

// Emoji data
const emojis = ['ðŸ˜€', 'ðŸ˜ƒ', 'ðŸ˜„', 'ðŸ˜', 'ðŸ˜†', 'ðŸ˜…', 'ðŸ¤£', 'ðŸ˜‚', 'ðŸ™‚', 'ðŸ™ƒ', 'ðŸ˜‰', 'ðŸ˜Š', 'ðŸ˜‡', 'ðŸ¥°', 'ðŸ˜', 'ðŸ¤©', 'ðŸ˜˜', 'ðŸ˜—', 'ðŸ˜š', 'ðŸ˜™', 'ðŸ¥²', 'ðŸ˜‹', 'ðŸ˜›', 'ðŸ˜œ', 'ðŸ¤ª', 'ðŸ˜', 'ðŸ¤‘', 'ðŸ¤—', 'ðŸ¤¬', 'ðŸ¤«', 'ðŸ¤”', 'ðŸ¤', 'ðŸ¤¨', 'ðŸ˜', 'ðŸ˜‘', 'ðŸ˜¶', 'ðŸ˜', 'ðŸ˜’', 'ðŸ™„', 'ðŸ˜¬', 'ðŸ¤¥', 'ðŸ˜Œ', 'ðŸ˜”', 'ðŸ˜ª', 'ðŸ¤¤', 'ðŸ˜´', 'ðŸ˜·', 'ðŸ¤’', 'ðŸ¤•', 'ðŸ¤¢', 'ðŸ¤®', 'ðŸ¤§', 'ðŸ¥µ', 'ðŸ¥¶', 'ðŸ¥´', 'ðŸ˜µ', 'ðŸ¤¯', 'ðŸ¤ ', 'ðŸ¥³', 'ðŸ¥¸', 'ðŸ˜Ž', 'ðŸ¤“', 'ðŸ§', 'ðŸ‘', 'ðŸ‘Ž', 'ðŸ‘Œ', 'âœŒï¸', 'ðŸ¤ž', 'ðŸ¤Ÿ', 'ðŸ¤˜', 'ðŸ¤™', 'ðŸ‘', 'ðŸ™Œ', 'ðŸ‘', 'ðŸ¤²', 'ðŸ™', 'âœï¸', 'ðŸ’…', 'ðŸ¤³', 'ðŸ’ª', 'ðŸ¦¾', 'ðŸ¦¿', 'ðŸ¦µ', 'ðŸ¦¶', 'ðŸ‘‚', 'ðŸ¦»', 'ðŸ‘ƒ', 'ðŸ§ ', 'ðŸ«€', 'ðŸ«', 'ðŸ¦·', 'ðŸ¦´', 'ðŸ‘€', 'ðŸ‘ï¸', 'ðŸ‘…', 'ðŸ‘„', 'ðŸ’‹', 'ðŸ©¸'];

const UserItem = ({ user, onSelect, isActive }) => {
  const lastConversation = user.conversations && user.conversations.length > 0 
    ? user.conversations[user.conversations.length - 1] 
    : null;
  
  const unreadCount = user.unreadCount || 0;
  
  return (
    <div 
      className={`user-item ${isActive ? 'active' : ''}`}
      onClick={() => onSelect(user)}
    >
      <div className="user-avatar-container">
        <img 
          src={`https://picsum.photos/seed/${user.userNumber}/48/48.jpg`} 
          alt={user.userName} 
          className="user-avatar" 
        />
        {unreadCount > 0 && (
          <div className="unread-badge">{unreadCount > 9 ? '9+' : unreadCount}</div>
        )}
      </div>
      <div className="user-info">
        <div className="user-info-header">
          <h4>{user.userName || `+${user.userNumber}`}</h4>
          {lastConversation && (
            <span className="last-message-time">{lastConversation.time}</span>
          )}
        </div>
        <p>
          {lastConversation ? (
            <>
              <span className="online-indicator"></span>
              {lastConversation.botReply ? lastConversation.botReply.substring(0, 30) + '...' : lastConversation.userMsg.substring(0, 30) + '...'}
            </>
          ) : (
            "â€”"
          )}
        </p>
      </div>
    </div>
  );
};

const Message = ({ message, isUser, status }) => (
  <div className={`message ${isUser ? 'user' : 'bot'}`}>
    <div className="message-content">
      <strong>{isUser ? 'You' : 'Bot'}</strong>
      {message.text}
      <div className="message-footer">
        <span className="message-time">{message.time}</span>
        {isUser && status && (
          <span className={`message-status status-${status}`}>
            {status === 'sent' && <i className="fas fa-check"></i>}
            {status === 'delivered' && <i className="fas fa-check-double"></i>}
            {status === 'read' && <i className="fas fa-check-double"></i>}
          </span>
        )}
      </div>
    </div>
  </div>
);

const TypingIndicator = () => (
  <div className="message bot">
    <div className="typing-indicator">
      <div className="typing-dot"></div>
      <div className="typing-dot"></div>
      <div className="typing-dot"></div>
    </div>
  </div>
);

const EmojiPicker = ({ onSelect, onClose }) => {
  const pickerRef = useRef(null);
  
  useEffect(() => {
    const handleClickOutside = (event) => {
      if (pickerRef.current && !pickerRef.current.contains(event.target)) {
        onClose();
      }
    };
    
    document.addEventListener('mousedown', handleClickOutside);
    return () => document.removeEventListener('mousedown', handleClickOutside);
  }, [onClose]);
  
  return (
    <div className="emoji-picker" ref={pickerRef}>
      <div className="emoji-picker-grid">
        {emojis.map((emoji, idx) => (
          <button
            key={idx}
            className="emoji-item"
            onClick={() => {
              onSelect(emoji);
              onClose();
            }}
          >
            {emoji}
          </button>
        ))}
      </div>
    </div>
  );
};

function App() {
  const [users, setUsers] = useState([]);
  const [selectedUser, setSelectedUser] = useState(null);
  const [userMsg, setUserMsg] = useState("");
  const [sidebarOpen, setSidebarOpen] = useState(false);
  const [isTyping, setIsTyping] = useState(false);
  const [searchQuery, setSearchQuery] = useState("");
  const [connectionStatus, setConnectionStatus] = useState("disconnected");
  const [theme, setTheme] = useState(localStorage.getItem('theme') || 'light');
  const [showEmojiPicker, setShowEmojiPicker] = useState(false);
  const [selectedFiles, setSelectedFiles] = useState([]);
  const [showScrollButton, setShowScrollButton] = useState(false);
  const [notificationPermission, setNotificationPermission] = useState(Notification.permission);
  const [showNotificationBanner, setShowNotificationBanner] = useState(
    Notification.permission === 'default'
  );
  const [draftMessages, setDraftMessages] = useState({});
  const [messageStatuses, setMessageStatuses] = useState({});
  
  const messagesEndRef = useRef(null);
  const chatMessagesRef = useRef(null);
  const wsRef = useRef(null);
  const reconnectTimeoutRef = useRef(null);
  const fileInputRef = useRef(null);

  // Load draft message when user changes
  useEffect(() => {
    if (selectedUser) {
      const draft = draftMessages[selectedUser.userNumber] || "";
      setUserMsg(draft);
    }
  }, [selectedUser, draftMessages]);

  // Save draft message when typing
  useEffect(() => {
    if (selectedUser && userMsg) {
      setDraftMessages(prev => ({
        ...prev,
        [selectedUser.userNumber]: userMsg
      }));
    }
  }, [userMsg, selectedUser]);

  // Apply theme
  useEffect(() => {
    document.documentElement.setAttribute('data-theme', theme);
    localStorage.setItem('theme', theme);
  }, [theme]);

  // Request notification permission
  const requestNotificationPermission = async () => {
    try {
      const permission = await Notification.requestPermission();
      setNotificationPermission(permission);
      setShowNotificationBanner(false);
      
      if (permission === 'granted') {
        new Notification('Notifications Enabled!', {
          body: 'You will now receive notifications for new messages.',
          icon: '/favicon.ico'
        });
      }
    } catch (err) {
      console.error('Notification permission error:', err);
    }
  };

  // Show browser notification
  const showNotification = (title, body) => {
    if (Notification.permission === 'granted') {
      new Notification(title, {
        body: body,
        icon: '/favicon.ico',
        badge: '/favicon.ico'
      });
    }
  };

  // Scroll to bottom handler
  const scrollToBottom = (smooth = true) => {
    if (messagesEndRef.current) {
      messagesEndRef.current.scrollIntoView({ behavior: smooth ? "smooth" : "auto" });
    }
  };

  // Handle scroll in messages area
  const handleScroll = () => {
    if (chatMessagesRef.current) {
      const { scrollTop, scrollHeight, clientHeight } = chatMessagesRef.current;
      const isNearBottom = scrollHeight - scrollTop - clientHeight < 100;
      setShowScrollButton(!isNearBottom && scrollHeight > clientHeight);
    }
  };

  const fetchUsers = async () => {
    try {
      const res = await fetch("http://54.221.144.70:3000/users");
      const data = await res.json();

      const sortedUsers = data.sort(
        (a, b) => new Date(b.lastInteracted) - new Date(a.lastInteracted)
      );

      setUsers(sortedUsers);
    } catch (err) {
      console.error("Error fetching users:", err);
    }
  };

  // Filter users based on search query
  const filteredUsers = useMemo(() => {
    if (!searchQuery.trim()) return users;
    
    const query = searchQuery.toLowerCase();
    return users.filter(user => {
      const userName = (user.userName || "").toLowerCase();
      const userNumber = user.userNumber.toString();
      
      return userName.includes(query) || userNumber.includes(query);
    });
  }, [users, searchQuery]);

  // Update selectedUser when users array changes
  useEffect(() => {
    if (selectedUser) {
      const updatedUser = users.find(user => user.userNumber === selectedUser.userNumber);
      if (updatedUser && JSON.stringify(updatedUser) !== JSON.stringify(selectedUser)) {
        setSelectedUser(updatedUser);
        
        // Reset unread count for selected user
        if (updatedUser.unreadCount > 0) {
          setUsers(prevUsers => 
            prevUsers.map(u => 
              u.userNumber === selectedUser.userNumber 
                ? { ...u, unreadCount: 0 }
                : u
            )
          );
        }
      }
    }
  }, [users, selectedUser]);

  useEffect(() => {
    fetchUsers();

    const connectWebSocket = () => {
      wsRef.current = new WebSocket("ws://54.221.144.70:3001");

      wsRef.current.onopen = () => {
        console.log("âœ… WebSocket connected");
        setConnectionStatus("connected");
        if (reconnectTimeoutRef.current) {
          clearTimeout(reconnectTimeoutRef.current);
          reconnectTimeoutRef.current = null;
        }
      };

      wsRef.current.onmessage = (event) => {
        try {
          const data = JSON.parse(event.data);
          
          if (data.type === "new_message") {
            setIsTyping(false);
            
            // Show notification if not the selected user
            if (selectedUser?.userNumber !== data.userNumber) {
              const user = users.find(u => u.userNumber === data.userNumber);
              const userName = user?.userName || `+${data.userNumber}`;
              showNotification(
                `New message from ${userName}`,
                data.conversation.userMsg || data.conversation.botReply
              );
            }
            
            setUsers(prevUsers => {
              const updated = prevUsers.map(u => {
                if (u.userNumber === data.userNumber) {
                  const isSelected = selectedUser?.userNumber === data.userNumber;
                  return {
                    ...u,
                    conversations: [...(u.conversations || []), data.conversation],
                    lastInteracted: new Date().toISOString(),
                    unreadCount: isSelected ? 0 : (u.unreadCount || 0) + 1
                  };
                }
                return u;
              });

              return updated.sort(
                (a, b) => new Date(b.lastInteracted) - new Date(a.lastInteracted)
              );
            });

            if (selectedUser?.userNumber === data.userNumber) {
              setSelectedUser(prev => ({
                ...prev,
                conversations: [...(prev.conversations || []), data.conversation],
                lastInteracted: new Date().toISOString()
              }));
              
              // Update message status
              const msgId = `${data.userNumber}-${Date.now()}`;
              setMessageStatuses(prev => ({
                ...prev,
                [msgId]: 'read'
              }));
            }
          }
          else if (data.type === "new_user") {
            setUsers(prev => {
              const exists = prev.find(u => u.userNumber === data.user.userNumber);
              if (exists) return prev;
              return [
                data.user,
                ...prev
              ].sort((a, b) => new Date(b.lastInteracted) - new Date(a.lastInteracted));
            });
            showNotification( `New Lead Added`,
                "Lead yet to start convo")
          }
          else if (data.type === "typing") {
            if (selectedUser?.userNumber === data.userNumber) {
              setIsTyping(true);
              setTimeout(() => setIsTyping(false), 3000);
            }
          }

        } catch (err) {
          console.error("WebSocket message parse error:", err);
        }
      };

      wsRef.current.onclose = () => {
        console.log("âš ï¸ WebSocket disconnected. Reconnecting in 3s...");
        setConnectionStatus("disconnected");
        
        reconnectTimeoutRef.current = setTimeout(() => {
          if (!wsRef.current || wsRef.current.readyState === WebSocket.CLOSED) {
            connectWebSocket();
          }
        }, 3000);
      };

      wsRef.current.onerror = (err) => {
        console.error("WebSocket error:", err);
        setConnectionStatus("error");
        wsRef.current.close();
      };
    };

    connectWebSocket();

    return () => {
      if (reconnectTimeoutRef.current) {
        clearTimeout(reconnectTimeoutRef.current);
      }
      wsRef.current?.close();
    };
  }, [selectedUser?.userNumber]);

  useEffect(() => {
    if (selectedUser) {
      scrollToBottom(false);
    }
  }, [selectedUser]);

  useEffect(() => {
    if (selectedUser?.conversations || isTyping) {
      scrollToBottom();
    }
  }, [selectedUser?.conversations, isTyping]);

  const handleFileSelect = (event) => {
    const files = Array.from(event.target.files);
    setSelectedFiles(prev => [...prev, ...files]);
  };

  const removeFile = (index) => {
    setSelectedFiles(prev => prev.filter((_, i) => i !== index));
  };

  const handleEmojiSelect = (emoji) => {
    setUserMsg(prev => prev + emoji);
  };

  const sendMessage = async () => {
    if ((!userMsg.trim() && selectedFiles.length === 0) || !selectedUser) return;

    const msgId = `${selectedUser.userNumber}-${Date.now()}`;
    const newConversation = { 
      userMsg: userMsg || `ðŸ“Ž ${selectedFiles.length} file(s)`, 
      botReply: "",
      time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
    };

    // Set initial status
    setMessageStatuses(prev => ({
      ...prev,
      [msgId]: 'sent'
    }));

    setSelectedUser(prev => ({
      ...prev,
      conversations: [...(prev.conversations || []), newConversation],
      lastInteracted: new Date().toISOString()
    }));

    setUsers(prev => {
      const updated = prev.map(u =>
        u.userNumber === selectedUser.userNumber
          ? { 
              ...u, 
              conversations: [...(u.conversations || []), newConversation],
              lastInteracted: new Date().toISOString()
            }
          : u
      );
      return updated.sort(
        (a, b) => new Date(b.lastInteracted) - new Date(a.lastInteracted)
      );
    });

    // Clear draft
    setDraftMessages(prev => {
      const newDrafts = { ...prev };
      delete newDrafts[selectedUser.userNumber];
      return newDrafts;
    });

    setUserMsg("");
    setSelectedFiles([]);
    setIsTyping(true);

    // Simulate delivery status
    setTimeout(() => {
      setMessageStatuses(prev => ({
        ...prev,
        [msgId]: 'delivered'
      }));
    }, 1000);

    if (wsRef.current && wsRef.current.readyState === WebSocket.OPEN) {
      wsRef.current.send(JSON.stringify({
        type: "new_message",
        userNumber: selectedUser.userNumber,
        conversation: newConversation
      }));
    } else {
      console.error("WebSocket is not connected. Message not sent.");
      setIsTyping(false);
    }
  };

  const handleDeleteChat = async () => {
    if (selectedUser) {
      const number = selectedUser.userNumber;
      
      try {
        await fetch(`http://54.221.144.70:3000/users/${number}`, {
          method: 'DELETE'
        });
      } catch (err) {
        console.error("Error deleting chat:", err);
      }
      
      setUsers(prev => prev.filter(u => u.userNumber !== number));
      setSelectedUser(null);
      console.log(`Deleted conversation with ${number}`);
    }
  };

  const handleUserSelect = (user) => {
    setSelectedUser(user);
    setSidebarOpen(false);
    
    // Reset unread count
    setUsers(prevUsers => 
      prevUsers.map(u => 
        u.userNumber === user.userNumber 
          ? { ...u, unreadCount: 0 }
          : u
      )
    );
  };

  const toggleSidebar = () => {
    setSidebarOpen(!sidebarOpen);
  };

  const toggleTheme = () => {
    setTheme(prev => prev === 'light' ? 'dark' : 'light');
  };

  const handleMobileMenuAction = (action) => {
    switch(action) {
      case 'video':
        console.log('Video call initiated');
        break;
      case 'phone':
        console.log('Voice call initiated');
        break;
      case 'delete':
        handleDeleteChat();
        break;
      case 'more':
        console.log('More options');
        break;
      default:
        break;
    }
    setSidebarOpen(false);
  };

  const handleSearchChange = (e) => {
    setSearchQuery(e.target.value);
  };

  // Calculate total unread messages
  const totalUnread = useMemo(() => {
    return users.reduce((sum, user) => sum + (user.unreadCount || 0), 0);
  }, [users]);

  // Update document title with unread count
  useEffect(() => {
    if (totalUnread > 0) {
      document.title = `(${totalUnread}) WhatsApp Dashboard`;
    } else {
      document.title = 'WhatsApp Dashboard - Premium';
    }
  }, [totalUnread]);

  return (
    <div className="container">
      {showNotificationBanner && (
        <div className="notification-banner">
          <div className="notification-banner-content">
            <i className="fas fa-bell"></i>
            <div className="notification-banner-text">
              <h4>Enable Notifications</h4>
              <p>Get notified when you receive new messages</p>
            </div>
          </div>
          <div className="notification-banner-actions">
            <button className="btn-enable" onClick={requestNotificationPermission}>
              Enable
            </button>
            <button className="btn-dismiss" onClick={() => setShowNotificationBanner(false)}>
              Not Now
            </button>
          </div>
        </div>
      )}
      
      <div className={`sidebar ${sidebarOpen ? 'open' : ''}`}>
        <div className="sidebar-header">
          <div className="sidebar-header-content">
            <i className="fab fa-whatsapp"></i>
            <h2>WhatsApp Dashboard</h2>
          </div>
          <button className="theme-toggle" onClick={toggleTheme} title="Toggle Theme">
            <i className={`fas fa-${theme === 'light' ? 'moon' : 'sun'}`}></i>
          </button>
          <button className="mobile-menu-toggle" onClick={toggleSidebar}>
            <i className="fas fa-times"></i>
          </button>
        </div>
        <div className="search-bar">
          <div className="search-container">
            <i className="fas fa-search search-icon"></i>
            <input 
              type="text" 
              placeholder="Search contacts..." 
              className="search-input"
              value={searchQuery}
              onChange={handleSearchChange}
            />
          </div>
        </div>
        <div className="users-list">
          {filteredUsers.length > 0 ? (
            filteredUsers.map(user => (
              <UserItem 
                key={user.userNumber} 
                user={user} 
                onSelect={handleUserSelect} 
                isActive={selectedUser?.userNumber === user.userNumber}
              />
            ))
          ) : users.length > 0 ? (
            <div className="no-results">
              <i className="fas fa-search" style={{ fontSize: '24px', marginBottom: '8px', opacity: 0.5 }}></i>
              <p>No contacts found matching "{searchQuery}"</p>
            </div>
          ) : (
            <div style={{ padding: '40px 20px', textAlign: 'center', color: '#8696a0' }}>
              <div className="loading-spinner" style={{ margin: '0 auto 16px' }}></div>
              <p>Loading users...</p>
            </div>
          )}
        </div>
        <div className="mobile-menu-items">
          {selectedUser && (
            <>
              <div className="mobile-menu-item" onClick={() => handleMobileMenuAction('video')}>
                <i className="fas fa-video"></i>
                <span>Video Call</span>
              </div>
              <div className="mobile-menu-item" onClick={() => handleMobileMenuAction('phone')}>
                <i className="fas fa-phone"></i>
                <span>Voice Call</span>
              </div>
              <div className="mobile-menu-item" onClick={() => handleMobileMenuAction('delete')}>
                <i className="fas fa-trash-alt"></i>
                <span>Delete Chat</span>
              </div>
              <div className="mobile-menu-item" onClick={() => handleMobileMenuAction('more')}>
                <i className="fas fa-ellipsis-v"></i>
                <span>More Options</span>
              </div>
            </>
          )}
        </div>
      </div>
      
      <div className={`sidebar-overlay ${sidebarOpen ? 'active' : ''}`} onClick={() => setSidebarOpen(false)}></div>

      <div className="main">
        {selectedUser ? (
          <>
            <div className="chat-header">
              <div className="chat-header-left">
                <button className="mobile-back-button" onClick={toggleSidebar}>
                  <i className="fas fa-arrow-left"></i>
                </button>
                <div className="chat-header-info">
                  <h3>{selectedUser.userName || `+${selectedUser.userNumber}`}</h3>
                  <p>
                    <span className="online-indicator"></span>
                    Mobile: +{selectedUser.userNumber}
                    {connectionStatus === "connected" && (
                      <span style={{ marginLeft: '8px', color: '#25d366' }}>
                        <i className="fas fa-circle" style={{ fontSize: '8px' }}></i> Connected
                      </span>
                    )}
                    {connectionStatus === "disconnected" && (
                      <span style={{ marginLeft: '8px', color: '#dc3545' }}>
                        <i className="fas fa-circle" style={{ fontSize: '8px' }}></i> Reconnecting...
                      </span>
                    )}
                  </p>
                </div>
              </div>
              <div className="chat-header-actions">
                <div style={{ textAlign: 'right', marginRight: '16px' }}>
                  <p style={{ fontSize: '12px', color: 'var(--text-secondary)', margin: 0 }}>Course</p>
                  <p style={{ fontSize: '13px', color: 'var(--text-primary)', margin: 0, fontWeight: 500 }}>
                    {selectedUser.course || "Not selected"}
                  </p>
                </div>
                <button className="header-action-btn" title="Video Call">
                  <i className="fas fa-video"></i>
                </button>
                <button className="header-action-btn" title="Voice Call">
                  <i className="fas fa-phone"></i>
                </button>
                <button className="header-action-btn" title="More Options">
                  <i className="fas fa-ellipsis-v"></i>
                </button>
                <i 
                  className="fas fa-trash-alt delete-icon" 
                  title="Delete Chat"
                  onClick={handleDeleteChat}
                ></i>
              </div>
            </div>
            <div 
              className="chat-messages" 
              ref={chatMessagesRef}
              onScroll={handleScroll}
            >
              {(selectedUser.conversations || []).map((conv, idx) => {
                const msgId = `${selectedUser.userNumber}-${idx}`;
                const status = messageStatuses[msgId] || 'read';
                
                return (
                  <React.Fragment key={idx}>
                    <Message 
                      message={{ text: conv.userMsg, time: conv.time }} 
                      isUser={true}
                      status={status}
                    />
                    {conv.botReply && (
                      <Message 
                        message={{ text: conv.botReply, time: conv.time }} 
                        isUser={false} 
                      />
                    )}
                  </React.Fragment>
                );
              })}
              {isTyping && <TypingIndicator />}
              <div ref={messagesEndRef} />
              
              {showScrollButton && (
                <button 
                  className="scroll-to-bottom"
                  onClick={() => scrollToBottom()}
                  title="Scroll to bottom"
                >
                  <i className="fas fa-chevron-down"></i>
                </button>
              )}
            </div>
            <div className="input-area">
              <div className="input-container">
                {selectedFiles.length > 0 && (
                  <div className="file-preview">
                    {selectedFiles.map((file, idx) => (
                      <div key={idx} className="file-preview-item">
                        {file.type.startsWith('image/') ? (
                          <img src={URL.createObjectURL(file)} alt={file.name} />
                        ) : (
                          <i className="fas fa-file"></i>
                        )}
                        <span>{file.name}</span>
                        <button 
                          className="file-preview-remove"
                          onClick={() => removeFile(idx)}
                        >
                          <i className="fas fa-times"></i>
                        </button>
                      </div>
                    ))}
                  </div>
                )}
                <div className="input-row">
                  <button 
                    className="input-action-btn"
                    onClick={() => setShowEmojiPicker(!showEmojiPicker)}
                  >
                    <i className="fas fa-smile"></i>
                  </button>
                  <textarea
                    rows="1"
                    value={userMsg}
                    onChange={e => setUserMsg(e.target.value)}
                    placeholder="Type a message..."
                    className="input-field"
                    onKeyPress={(e) => {
                      if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        sendMessage();
                      }
                    }}
                  />
                  <button 
                    className="input-action-btn"
                    onClick={() => fileInputRef.current?.click()}
                  >
                    <i className="fas fa-paperclip"></i>
                  </button>
                  <input
                    ref={fileInputRef}
                    type="file"
                    multiple
                    accept="image/*,video/*,application/pdf"
                    onChange={handleFileSelect}
                    className="file-input"
                  />
                </div>
                {showEmojiPicker && (
                  <EmojiPicker 
                    onSelect={handleEmojiSelect}
                    onClose={() => setShowEmojiPicker(false)}
                  />
                )}
              </div>
              <button 
                onClick={sendMessage} 
                className="send-button"
                disabled={!userMsg.trim() && selectedFiles.length === 0}
              >
                <i className="fas fa-paper-plane"></i>
                Send
              </button>
            </div>
          </>
        ) : (
          <div className="no-user-selected">
            <div className="no-user-content">
              <i className="fab fa-whatsapp"></i>
              <h3>WhatsApp Dashboard</h3>
              <p>Select a contact to start chatting</p>
              {totalUnread > 0 && (
                <p style={{ color: 'var(--primary-color)', fontWeight: 600 }}>
                  {totalUnread} unread message{totalUnread > 1 ? 's' : ''}
                </p>
              )}
              <button 
                className="send-button" 
                onClick={toggleSidebar}
              >
                <i className="fas fa-users"></i>
                Show Contacts
              </button>
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById("root")).render(<App />);
</script>
</body>
</html>
